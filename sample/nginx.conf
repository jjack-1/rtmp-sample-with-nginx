# nginx.conf (진단용 버전)
daemon off;
error_log /dev/stdout info;

events {
    worker_connections 1024;
    use epoll;
}

rtmp {
    server {
        listen 1935;
        chunk_size 4000;

        application live {
            live on;
            allow play 127.0.0.1;
            deny play all;

            # ✅ [핵심 진단 코드] sh -c 구문이 ffmpeg를 정상적으로 실행할 수 있는지 테스트합니다.
            # 1. /usr/local/bin/ffmpeg -version 명령어를 실행하고,
            # 2. 그 결과(표준 출력과 표준 에러 모두)를 /opt/data/ffmpeg_version.log 파일에 씁니다.
            # 3. & 를 붙여 백그라운드로 실행합니다.
            exec sh -c "/usr/local/bin/ffmpeg -version > /opt/data/ffmpeg_version.log 2>&1 &";
        }
    }
}

http {
    server {
        listen 80;
        location / { root /www/static; }
    }
}
